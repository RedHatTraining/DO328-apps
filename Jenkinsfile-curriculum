node {
    stage('Load Jenkinsfiles') {
        checkout scm
    }

    stage('Adopt-a-pup/web-app') {
        if (isChanged('adopt-a-pup/web-app/')) {
            load 'adopt-a-pup/web-app/Jenkinsfile'
        }
    }

}


@NonCPS
def isChanged(dir) {
  for (changeLogSet in currentBuild.changeSets) {
    for (entry in changeLogSet.getItems()) { // for each commit in the detected changes
      for (file in entry.getAffectedFiles()) {
        if (file.getPath().startsWith(dir)) {
          return true
        }
      }
    }
  }
  return false
}