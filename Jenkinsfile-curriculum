node {
    stage('Check changes') {
        checkout scm
    }

    // Only one project pipeline can be executed in one run.
    // CI will fail if the change set contains changes across several projects
    runIfChanged('adopt-a-pup/web-app/')
    // runIfChanged('other/project/')
}


@NonCPS
def runIfChanged(projectDir) {
    for (changeSet in currentBuild.changeSets) {
        for (changeItems in changeSet.getItems()) {
            for (file in changeItems.getAffectedFiles()) {
                if (file.getPath().startsWith(projectDir)) {
                    load "$projectDir/Jenkinsfile"
                }
            }
        }
    }
    return false
}